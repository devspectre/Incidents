{% extends "base.html" %}

{% block title %}Fire Incidents Insight: {{data.description.incident_number}}{% endblock %}
{% block extra_style %}
<style>
html {
    font-size: 62.5%;
}

html, body {
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
}

body {
    background: white;
    font-family: 'Roboto', sans-serif;
}

* {
    box-sizing: border-box;
}

#root {
    height: 100%;
    width: 100%;
}

.content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 2rem;
}

#map {
    height: 500px;
    width: 100%;
}
</style>
{% endblock %}
{% block body %}
<script type="text/javascript">
    $(document).ready(function () {
        var lat = parseFloat('{{data.address.latitude}}')
        var lon = parseFloat('{{data.address.longitude}}')
        var insightMap = L.map('map').setView([lat, lon], 18);
        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1Ijoic3BhcnRhbjA0MDgiLCJhIjoiY2t3MHFzMmU2YWtndDMxcTE2bWl4dGRseCJ9.yu3cJ5vzrN1qOLC6-lSoqA'
        }).addTo(insightMap);

        var circle = L.circle([lat, lon], {
            color: 'red',
            fillColor: '#f03',
            fillOpacity: 0.5,
            radius: 10
        }).addTo(insightMap)

        var unitLocations = []
        {% for unit in data.apparatus %}
            var _lat = parseFloat('{{unit.unit_status.arrived.latitude}}')
            var _lon = parseFloat('{{unit.unit_status.arrived.longitude}}')
            var popupHtml = `
            <h5>ID: {{unit.unit_id}}</h5>
            <h5>Station: {{unit.station}}</h5>
            <h5>Car: {{unit.car_id}}</h5>
            <h5>Type: {{unit.unit_type}}</h5>
            `
            var marker = new L.marker([_lat, _lon]).addTo(insightMap)
            marker.bindPopup(popupHtml)
            unitLocations.push([_lat, _lon])
        {% endfor %}

        var polygon = L.polygon(unitLocations).addTo(insightMap)
    });
</script>
<div id="root">
    <div class="content">
        <h1>Fire Incidents Insight: {{data.description.incident_number}}</h1>
        <div id="map"></div>
    </div>
</div>
{% endblock %}
